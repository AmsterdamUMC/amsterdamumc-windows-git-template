#!/bin/bash

#
#
# Additions to a pre-commit check specific for the AmsterdamUMC
#
# TODO The implementation of the JIRA-task in the order found in 
# sub-tasks of RDMR-373

DATA_DIR=private-data/

DIRECTORIES_TO_CHECK=`ls -dr */`
EXCLUDED_DIRECTORIES=(
	$DATA_DIR
)



#
# Function to display a message to the user that a potential issue has been
# found in a file about to be commited / pushed.
#
# # Required parameters:
# $1 the message
#
# Example:
# message('The file letter.txt contains a surname')

message() {
	echo "Note: "
} 


#echo "Starting pre-commit checks in:"
#echo "$DIRECTORIES_TO_CHECK"
#echo "Excluded are:"
#echo "$EXCLUDED_DIRECTORIES"


echo "Performing pre-commit checks"

# exec ".amsterdamumc-scripts/scan-surnames.bat"
exec "findstr /I /N /S /G:.amsterdamumc-scripts\lookup_items\surnames.txt ../*"

exit 777

# 
# Check existance .gitignore
# 
if [ -f .gitignore ]; then
	echo "OK: .gitignore present"
else
	echo ">> NOTE: .gitignore not present"
fi

#
# Check if excluded data directory is in .gitignore
# and if it exists on FS
# 
if [ -d $DATA_DIR ]; then
	echo "OK: $DATA_DIR directory present"
	if [ -f .gitignore ]; then
		
		NUMBER_MATCHES_FOUND=$(grep -c -e $DATA_DIR .gitignore)
		
		if [[ NUMBER_MATCHES_FOUND -ne 0 ]]; then
			echo "OK: Private / confidential data directory found in .gitignore"
		else
			echo ">> NOTE: Private / confidential data-directory not present in .gitignore"
		fi
	fi
else
	echo ">> NOTE: $DATA_DIR directory not present"
fi

#
# Scan the all underlying directories and the top directory (except the 
# DATA_DIR) for files containing surnames. Based on the files from the
# DEDUCE project: https://github.com/vmenger/deduce/tree/main/deduce/data/lookup/src/names 
# Publication: http://www.sciencedirect.com/science/article/pii/S0736585316307365 
#
# The follwing surnames have been removed to eliminate false-positive warning 
# messages:

exit 777
echo "Finished pre-commit checks"
